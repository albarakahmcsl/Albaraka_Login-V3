import{d as I,r as c,R as K,q as f,j as t}from"./index-F6-kWaLA.js";import{u as F,a as T,P as $,S as Q}from"./search-Cdt3ekHK.js";import{S as R}from"./square-pen-b5NdsDRf.js";class p extends Error{constructor(e){super(e),this.name="ApiError"}}const w="/api/members",N={getMembers:async()=>{const n=await fetch(`${w}`);if(!n.ok)throw new p("Failed to fetch members");return n.json()},createMember:async n=>{const e=await fetch(`${w}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok)throw new p("Failed to create member");return e.json()},updateMember:async(n,e)=>{const i=await fetch(`${w}/${n}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok)throw new p("Failed to update member");return i.json()}},O={getAccountTypes:async()=>{const n=await fetch("/api/account-types");if(!n.ok)throw new p("Failed to fetch account types");return n.json()}};function J(){const n=I(),[e,i]=c.useState(""),[g,h]=c.useState(!1),[r,d]=c.useState(!1),[l,x]=c.useState(null),[u,s]=c.useState(null),[o,y]=c.useState(null);K.useEffect(()=>{if(u||o){const a=setTimeout(()=>{s(null),y(null)},5e3);return()=>clearTimeout(a)}},[u,o]);const{data:j,isLoading:E}=F({queryKey:f.members(),queryFn:N.getMembers}),{data:b}=F({queryKey:f.accountTypes(),queryFn:O.getAccountTypes}),v=T({mutationFn:N.createMember,onSuccess:()=>{y("Member created successfully"),s(null),h(!1),n.invalidateQueries({queryKey:f.members()})},onError:a=>{s(a instanceof p?a.message:"Failed to create member"),y(null)}}),C=T({mutationFn:({memberId:a,memberData:m})=>N.updateMember(a,m),onSuccess:()=>{y("Member updated successfully"),s(null),d(!1),x(null),n.invalidateQueries({queryKey:f.members()})},onError:a=>{s(a instanceof p?a.message:"Failed to update member"),y(null)}}),q=a=>v.mutate(a),P=a=>{l&&C.mutate({memberId:l.id,memberData:a})},A=(j==null?void 0:j.members)||[],M=(b==null?void 0:b.account_types)||[],S=A.filter(a=>{var m;return a.name.toLowerCase().includes(e.toLowerCase())||a.email.toLowerCase().includes(e.toLowerCase())||((m=a.phone)==null?void 0:m.toLowerCase().includes(e.toLowerCase()))}),L=E||v.isPending||C.isPending;return t.jsxs("div",{className:"space-y-6 pt-24",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:"Members Management"}),t.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage members and their account types"})]}),t.jsxs("button",{onClick:()=>h(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700",children:[t.jsx($,{className:"h-4 w-4 mr-2"})," Add Member"]})]}),u&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:t.jsx("p",{className:"text-red-800",children:u})}),o&&t.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:t.jsx("p",{className:"text-green-800",children:o})}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:t.jsx(Q,{className:"h-5 w-5 text-gray-400"})}),t.jsx("input",{type:"text",value:e,onChange:a=>i(a.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Search members..."})]}),t.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:L?t.jsx("div",{className:"flex items-center justify-center py-12",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600"})}):S.length===0?t.jsx("div",{className:"text-center py-12",children:t.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No members found"})}):t.jsx("ul",{className:"divide-y divide-gray-200",children:S.map(a=>t.jsxs("li",{className:"px-4 py-4 flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:a.name}),t.jsx("span",{className:"text-sm text-gray-500",children:a.email}),t.jsx("span",{className:"text-sm text-gray-500",children:a.phone})]}),t.jsx("div",{className:"flex items-center space-x-2",children:t.jsx("button",{onClick:()=>{x(a),d(!0)},className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-blue-600 hover:bg-blue-700",title:"Edit member",children:t.jsx(R,{className:"h-4 w-4"})})})]},a.id))})}),g&&t.jsx(k,{mode:"create",onClose:()=>h(!1),onSubmit:q,accountTypes:M}),r&&l&&t.jsx(k,{mode:"edit",member:l,onClose:()=>{d(!1),x(null)},onSubmit:P,accountTypes:M})]})}function k({mode:n,member:e,onClose:i,onSubmit:g,accountTypes:h}){const[r,d]=c.useState({name:(e==null?void 0:e.name)||"",address:(e==null?void 0:e.address)||"",dob:(e==null?void 0:e.dob)||"",gender:(e==null?void 0:e.gender)||"",email:(e==null?void 0:e.email)||"",phone:(e==null?void 0:e.phone)||"",idCardNumber:(e==null?void 0:e.idCardNumber)||"",age:(e==null?void 0:e.age)||"",occupation:(e==null?void 0:e.occupation)||"",maritalStatus:(e==null?void 0:e.maritalStatus)||"",accountTypeId:(e==null?void 0:e.accountTypeId)||"",documents:(e==null?void 0:e.documents)||{birthCertificate:!1,idCopy:!1,applicationFeePaid:!1}}),l=(s,o)=>d({...r,[s]:o}),x=(s,o)=>d({...r,documents:{...r.documents,[s]:o}}),u=s=>{s.preventDefault(),g(r)};return t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:t.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:n==="create"?"Create New Member":"Edit Member"}),t.jsxs("form",{onSubmit:u,className:"space-y-2",children:[t.jsx("input",{type:"text",placeholder:"Full Name",value:r.name,onChange:s=>l("name",s.target.value),className:"block w-full border rounded px-3 py-2",required:!0}),t.jsx("input",{type:"email",placeholder:"Email",value:r.email,onChange:s=>l("email",s.target.value),className:"block w-full border rounded px-3 py-2"}),t.jsx("input",{type:"text",placeholder:"Phone",value:r.phone,onChange:s=>l("phone",s.target.value),className:"block w-full border rounded px-3 py-2"}),t.jsxs("select",{value:r.accountTypeId,onChange:s=>l("accountTypeId",s.target.value),className:"block w-full border rounded px-3 py-2",required:!0,children:[t.jsx("option",{value:"",children:"Select Account Type"}),h.map(s=>t.jsxs("option",{value:s.id,children:[s.name," - Fee: ",s.processingFee]},s.id))]}),["birthCertificate","idCopy","applicationFeePaid"].map(s=>t.jsxs("label",{className:"flex items-center",children:[t.jsx("input",{type:"checkbox",checked:r.documents[s],onChange:o=>x(s,o.target.checked),className:"mr-2"}),s==="birthCertificate"?"Birth Certificate":s==="idCopy"?"ID Copy":"Application Fee Paid"]},s)),t.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[t.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 bg-gray-100 rounded-md",children:"Cancel"}),t.jsx("button",{type:"submit",className:`px-4 py-2 rounded-md text-white ${n==="create"?"bg-emerald-600":"bg-blue-600"}`,children:n==="create"?"Create Member":"Save Changes"})]})]})]})})}export{J as MembersPage};
