import{d as Y,u as E,r as u,f as W,h as S,j as e,K as G,a as H,R as A,p as C,i as P,q as y}from"./index-DRBGyz_B.js";import{u as M,P as J,S as X,T as Z}from"./trash-2-CmXc8hsu.js";import{S as ee}from"./square-pen-CdezQdSx.js";const U=[{name:"read",label:"Read",description:"View and read information"},{name:"create",label:"Create",description:"Create new records"},{name:"update",label:"Update",description:"Modify existing records"},{name:"delete",label:"Delete",description:"Remove records from the system"},{name:"manage",label:"Manage",description:"Full management capabilities (all actions)"},{name:"view",label:"View",description:"View detailed information and reports"},{name:"other",label:"Other",description:"Other specialized actions"}],_=["ui_menu","ui_component"],N=[{name:"dashboard",label:"Dashboard",description:"Main dashboard and overview pages",category:"Core System",actions:[{name:"access",label:"Access",description:"View dashboard and overview information"},{name:"view_stats",label:"View Statistics",description:"View dashboard statistics and metrics"}]},{name:"admin",label:"Administration",description:"Administrative functions and panels",category:"Core System",actions:[{name:"access",label:"Access",description:"Access administrative panels and functions"}]},{name:"users",label:"Users",description:"User accounts and profiles",category:"User Management",actions:[{name:"activate",label:"Activate",description:"Activate or deactivate user accounts"},{name:"reset_password",label:"Reset Password",description:"Force password reset for users"}]},{name:"roles",label:"Roles",description:"User roles and role assignments",category:"User Management",actions:[{name:"assign",label:"Assign",description:"Assign roles to users"}]},{name:"permissions",label:"Permissions",description:"System permissions and access control",category:"User Management",actions:[]},{name:"bank_accounts",label:"Bank Accounts",description:"Bank account management",category:"Financial Management",actions:[]},{name:"account_types",label:"Account Types",description:"Islamic finance account type configurations",category:"Financial Management",actions:[{name:"configure",label:"Configure",description:"Configure account type rules and properties"}]},{name:"transactions",label:"Transactions",description:"Financial transactions and transfers",category:"Financial Management",actions:[{name:"approve",label:"Approve",description:"Approve pending transactions"},{name:"reject",label:"Reject",description:"Reject pending transactions"}]},{name:"reports",label:"Reports",description:"System reports and analytics",category:"Reporting & Analytics",actions:[{name:"export",label:"Export",description:"Export reports to various formats"},{name:"schedule",label:"Schedule",description:"Schedule automated report generation"}]},{name:"analytics",label:"Analytics",description:"Business intelligence and data analytics",category:"Reporting & Analytics",actions:[{name:"export",label:"Export",description:"Export analytics data"}]},{name:"customers",label:"Customers",description:"Customer accounts and profiles",category:"Customer Management",actions:[{name:"kyc",label:"KYC Management",description:"Manage Know Your Customer processes"}]},{name:"loans",label:"Loans",description:"Islamic finance loan products and applications",category:"Financial Products",actions:[{name:"approve",label:"Approve",description:"Approve loan applications"},{name:"reject",label:"Reject",description:"Reject loan applications"}]},{name:"investments",label:"Investments",description:"Sharia-compliant investment products",category:"Financial Products",actions:[]},{name:"settings",label:"System Settings",description:"System configuration and settings",category:"System Configuration",actions:[]},{name:"audit_logs",label:"Audit Logs",description:"System audit trails and logs",category:"System Configuration",actions:[{name:"export",label:"Export",description:"Export audit logs for compliance"}]},{name:"ui_menu",label:"UI Menu",description:"User interface menu access",category:"User Interface",actions:[{name:"dashboard",label:"Dashboard Menu",description:"Access to dashboard menu item"},{name:"admin",label:"Admin Menu",description:"Access to admin menu items"},{name:"reports",label:"Reports Menu",description:"Access to reports menu item"},{name:"transactions",label:"Transactions Menu",description:"Access to transactions menu item"},{name:"analytics",label:"Analytics Menu",description:"Access to analytics menu item"},{name:"settings",label:"Settings Menu",description:"Access to settings menu item"}]},{name:"ui_component",label:"UI Component",description:"User interface component access",category:"User Interface",actions:[{name:"user_profile",label:"User Profile",description:"Access to user profile components"},{name:"admin_panel",label:"Admin Panel",description:"Access to admin panel components"},{name:"financial_widgets",label:"Financial Widgets",description:"Access to financial dashboard widgets"}]}],R=t=>{const r=N.find(a=>a.name===t);if(!r)return[];if(_.includes(t))return r.actions.map(a=>({value:a.name,label:a.label,description:a.description}));const m=r.actions.map(a=>({value:a.name,label:a.label,description:a.description})),c=U.map(a=>({value:a.name,label:a.label,description:a.description}));return[...m,...c].filter((a,f,g)=>g.findIndex(p=>p.value===a.value)===f)},K=(t,r)=>{const m=N.find(l=>l.name===t),c=m==null?void 0:m.actions.find(l=>l.name===r);if(c)return c.description;const n=U.find(l=>l.name===r);return n?`${n.description} for ${(m==null?void 0:m.label)||t}`:`${r} permission for ${t}`},L=()=>N.reduce((t,r)=>(t[r.category]||(t[r.category]=[]),t[r.category].push(r),t),{}),se=t=>N.some(r=>r.name===t),te=(t,r)=>{const m=N.find(n=>n.name===t);return m?m.actions.some(n=>n.name===r)?!0:_.includes(t)?!1:U.some(n=>n.name===r):!1},T=(t,r)=>se(t)&&te(t,r);function le(){const t=Y(),{user:r,loading:m}=E(),[c,n]=u.useState(""),[l,a]=u.useState(!1),[f,g]=u.useState(!1),[p,x]=u.useState(null),[v,h]=u.useState(null),[o,s]=u.useState(null),{data:d=[],isLoading:j}=W({queryKey:y.permissionsManagement(),queryFn:C.getPermissions,enabled:!m&&!!r&&S(r,"permissions","view")}),k=M({mutationFn:C.createPermission,onSuccess:()=>{s("Permission created successfully"),a(!1),t.invalidateQueries({queryKey:y.permissionsManagement()}),t.invalidateQueries({queryKey:y.rolesManagement()})},onError:i=>{h(i instanceof P?i.message:"Failed to create permission")}}),F=M({mutationFn:({permissionId:i,permissionData:b})=>C.updatePermission(i,b),onSuccess:()=>{s("Permission updated successfully"),g(!1),x(null),t.invalidateQueries({queryKey:y.permissionsManagement()}),t.invalidateQueries({queryKey:y.rolesManagement()})},onError:i=>{h(i instanceof P?i.message:"Failed to update permission")}}),D=M({mutationFn:C.deletePermission,onSuccess:()=>{s("Permission deleted successfully"),t.invalidateQueries({queryKey:y.permissionsManagement()}),t.invalidateQueries({queryKey:y.rolesManagement()})},onError:i=>{h(i instanceof P?i.message:"Failed to delete permission")}}),V=i=>{k.mutate(i)},O=i=>{p&&F.mutate({permissionId:p.id,permissionData:i})},Q=i=>{confirm("Are you sure you want to delete this permission? This action cannot be undone.")&&D.mutate(i)},B=j||k.isPending||F.isPending||D.isPending,z=d.filter(i=>i.resource.toLowerCase().includes(c.toLowerCase())||i.action.toLowerCase().includes(c.toLowerCase())||i.description&&i.description.toLowerCase().includes(c.toLowerCase())).reduce((i,b)=>(i[b.resource]||(i[b.resource]=[]),i[b.resource].push(b),i),{}),q=S(r,"permissions","create"),I=S(r,"permissions","update"),$=S(r,"permissions","delete");return e.jsxs("div",{className:"space-y-6 pt-24",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(G,{className:"h-7 w-7 text-emerald-600 mr-2"}),"Permission Management"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Create and manage system permissions for granular access control"})]}),q&&e.jsxs("button",{onClick:()=>a(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Add Permission"]})]}),v&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("p",{className:"text-red-800",children:v})}),o&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsx("p",{className:"text-green-800",children:o})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(X,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:c,onChange:i=>n(i.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Search permissions..."})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:B?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600"})}):e.jsx("div",{className:"space-y-6 p-6",children:Object.entries(z).map(([i,b])=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4 capitalize flex items-center",children:[e.jsx(H,{className:"h-5 w-5 text-emerald-600 mr-2"}),i," Permissions"]}),e.jsx("div",{className:"space-y-3",children:b.map(w=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[w.resource,".",w.action]}),e.jsx("div",{className:"text-sm text-gray-500",children:w.description||"No description"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[I&&e.jsx("button",{onClick:()=>{x(w),g(!0)},className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:"Edit permission",children:e.jsx(ee,{className:"h-4 w-4"})}),$&&e.jsx("button",{onClick:()=>Q(w.id),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",title:"Delete permission",children:e.jsx(Z,{className:"h-4 w-4"})})]})]},w.id))})]},i))})}),l&&q&&e.jsx(ne,{onClose:()=>a(!1),onSubmit:V}),f&&p&&I&&e.jsx(ae,{permission:p,onClose:()=>{g(!1),x(null)},onSubmit:O})]})}function ne({onClose:t,onSubmit:r}){const{user:m}=E(),[c,n]=u.useState({resource:"",action:"",description:""}),[l,a]=u.useState(""),[f,g]=u.useState([]);A.useEffect(()=>{if(l){const o=R(l);g(o),n(s=>({...s,action:"",description:""}))}else g([])},[l]),A.useEffect(()=>{if(c.resource&&c.action){const o=K(c.resource,c.action);n(s=>({...s,description:o}))}},[c.resource,c.action]);const p=o=>{a(o),n(s=>({...s,resource:o,action:"",description:""}))},x=o=>{n(s=>({...s,action:o}))},v=o=>{if(o.preventDefault(),!T(c.resource,c.action)){alert("Invalid resource and action combination");return}r(c)},h=L();return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-[500px] shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Permission"}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Resource"}),e.jsxs("select",{required:!0,value:c.resource,onChange:o=>p(o.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",children:[e.jsx("option",{value:"",children:"Select a resource"}),Object.entries(h).map(([o,s])=>e.jsx("optgroup",{label:o,children:s.map(d=>e.jsxs("option",{value:d.name,children:[d.label," - ",d.description]},d.name))},o))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Action"}),e.jsxs("select",{required:!0,value:c.action,onChange:o=>x(o.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",disabled:!l,children:[e.jsx("option",{value:"",children:"Select an action"}),f.map(o=>e.jsxs("option",{value:o.value,children:[o.label," - ",o.description]},o.value))]}),!l&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a resource first to see available actions"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:c.description,onChange:o=>n(s=>({...s,description:o.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",rows:3,placeholder:"Description will be auto-filled based on your selection, but you can customize it"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This description helps other administrators understand what this permission grants"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!S(m,"permissions","create"),className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Create Permission"})]})]})]})})})}function ae({permission:t,onClose:r,onSubmit:m}){const{user:c}=E(),[n,l]=u.useState({resource:t.resource,action:t.action,description:t.description||""}),[a,f]=u.useState(t.resource),[g,p]=u.useState([]);A.useEffect(()=>{if(a){const s=R(a);p(s)}},[a]),A.useEffect(()=>{if(a&&a!==t.resource){const s=R(a);p(s),l(d=>({...d,action:"",description:""}))}},[a,t.resource]),A.useEffect(()=>{if(n.resource&&n.action&&(n.resource!==t.resource||n.action!==t.action)){const s=K(n.resource,n.action);l(d=>({...d,description:s}))}},[n.resource,n.action,t.resource,t.action]);const x=s=>{f(s),l(d=>({...d,resource:s}))},v=s=>{l(d=>({...d,action:s}))},h=s=>{if(s.preventDefault(),!T(n.resource,n.action)){alert("Invalid resource and action combination");return}m(n)},o=L();return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-[500px] shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit Permission"}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Resource"}),e.jsxs("select",{required:!0,value:n.resource,onChange:s=>x(s.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",children:[e.jsx("option",{value:"",children:"Select a resource"}),Object.entries(o).map(([s,d])=>e.jsx("optgroup",{label:s,children:d.map(j=>e.jsxs("option",{value:j.name,children:[j.label," - ",j.description]},j.name))},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Action"}),e.jsxs("select",{required:!0,value:n.action,onChange:s=>v(s.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",disabled:!a,children:[e.jsx("option",{value:"",children:"Select an action"}),g.map(s=>e.jsxs("option",{value:s.value,children:[s.label," - ",s.description]},s.value))]}),!a&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a resource first to see available actions"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:n.description,onChange:s=>l(d=>({...d,description:s.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",rows:3}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This description helps other administrators understand what this permission grants"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!S(c,"permissions","update"),className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Update Permission"})]})]})]})})})}export{le as AdminPermissions};
