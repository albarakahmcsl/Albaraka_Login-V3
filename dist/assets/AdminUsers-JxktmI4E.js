import{c as K,j as e,d as J,e as W,u as q,r as c,f as L,h as g,a as Y,g as N,i as S,q as b,k as ee,l as se}from"./index-DRBGyz_B.js";import{u as M,P as te,S as re,T as ae}from"./trash-2-CmXc8hsu.js";import{S as le}from"./square-pen-CdezQdSx.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=K("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=K("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function ie({isOpen:a,onClose:d,onConfirm:i,title:f,message:n,confirmText:l="Confirm",cancelText:u="Cancel",variant:x="danger"}){if(!a)return null;const t=(()=>{switch(x){case"danger":return{iconColor:"text-red-600",iconBg:"bg-red-100",confirmButton:"bg-red-600 hover:bg-red-700 focus:ring-red-500"};case"warning":return{iconColor:"text-yellow-600",iconBg:"bg-yellow-100",confirmButton:"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500"};case"info":return{iconColor:"text-blue-600",iconBg:"bg-blue-100",confirmButton:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"};default:return{iconColor:"text-red-600",iconBg:"bg-red-100",confirmButton:"bg-red-600 hover:bg-red-700 focus:ring-red-500"}}})(),o=h=>{h.target===h.currentTarget&&d()};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50 flex items-center justify-center",onClick:o,children:e.jsx("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex-shrink-0 h-10 w-10 rounded-full ${t.iconBg} flex items-center justify-center`,children:e.jsx(ne,{className:`h-6 w-6 ${t.iconColor}`})}),e.jsx("h3",{className:"ml-3 text-lg font-medium text-gray-900",children:f})]}),e.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(oe,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"mb-6",children:e.jsx("p",{className:"text-sm text-gray-600",children:n})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:u}),e.jsx("button",{type:"button",onClick:()=>{i(),d()},className:`px-4 py-2 text-sm font-medium text-white rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 ${t.confirmButton}`,children:l})]})]})})})}function fe(){const a=J(),d=W(),{user:i,loading:f}=q(),[n,l]=c.useState(""),[u,x]=c.useState(!1),[r,t]=c.useState(!1),[o,h]=c.useState(null),[D,w]=c.useState(null),[T,_]=c.useState(null),[Q,p]=c.useState(!1),[y,j]=c.useState(null),[$,v]=c.useState(""),{data:C,isLoading:z}=L({queryKey:b.usersManagement(),queryFn:N.getUsers,initialData:{users:d.users},enabled:!f&&!!i&&g(i,"users","view")}),{data:E}=L({queryKey:b.rolesManagement(),queryFn:se.getRoles,initialData:d.roles,enabled:!f&&!!i&&g(i,"roles","view")}),F=M({mutationFn:N.createUser,onSuccess:()=>{_("User created successfully"),x(!1),a.invalidateQueries({queryKey:b.usersManagement()})},onError:s=>{w(s instanceof S?s.message:"Failed to create user")}}),P=M({mutationFn:({userId:s,userData:m})=>N.updateUser(s,m),onSuccess:()=>{_("User updated successfully"),t(!1),h(null),a.invalidateQueries({queryKey:b.usersManagement()})},onError:s=>{w(s instanceof S?s.message:"Failed to update user")}}),k=M({mutationFn:N.deleteUser,onSuccess:()=>{_("User deleted successfully"),a.setQueryData(b.usersManagement(),s=>!s||!y?s:{...s,users:s.users.filter(m=>m.id!==y)}),p(!1),j(null),v(""),a.invalidateQueries({queryKey:b.usersManagement()})},onError:s=>{w(s instanceof S?s.message:"Failed to delete user"),p(!1),j(null),v("")}}),I=s=>{F.mutate(s)},V=s=>{o&&P.mutate({userId:o.id,userData:s})},X=s=>{const m=A.find(U=>U.id===s);m&&(j(s),v(m.full_name||m.email),p(!0))},O=()=>{y&&k.mutate(y)},A=(C==null?void 0:C.users)||[],Z=z||F.isPending||P.isPending||k.isPending,G=A.filter(s=>s.email.toLowerCase().includes(n.toLowerCase())||s.full_name.toLowerCase().includes(n.toLowerCase())),B=g(i,"users","create"),R=g(i,"users","update"),H=g(i,"users","delete");return e.jsxs("div",{className:"space-y-6 pt-24",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage user accounts, roles, and permissions"})]}),B&&e.jsxs("button",{onClick:()=>x(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),D&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("p",{className:"text-red-800",children:D})}),T&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsx("p",{className:"text-green-800",children:T})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(re,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:n,onChange:s=>l(s.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Search users..."})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:Z?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600"})}):e.jsx("ul",{className:"divide-y divide-gray-200",children:G.map(s=>{var m;return e.jsx("li",{children:e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-emerald-100 flex items-center justify-center",children:e.jsx(Y,{className:"h-5 w-5 text-emerald-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.full_name||"No name"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.is_active?"Active":"Inactive"}),s.needs_password_reset&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Password Reset Required"})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:s.email}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Roles: ",((m=s.roles)==null?void 0:m.map(U=>U.name).join(", "))||"No roles"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[R&&e.jsx("button",{onClick:()=>{h(s),t(!0)},className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:"Edit user",children:e.jsx(le,{className:"h-4 w-4"})}),H&&e.jsx("button",{onClick:()=>X(s.id),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",disabled:k.isPending,title:"Delete user",children:e.jsx(ae,{className:"h-4 w-4"})})]})]})},s.id)})})}),u&&B&&e.jsx(de,{roles:E||[],onClose:()=>x(!1),onSubmit:I}),r&&o&&R&&e.jsx(ce,{user:o,roles:E||[],onClose:()=>{t(!1),h(null)},onSubmit:V}),e.jsx(ie,{isOpen:Q,onClose:()=>{p(!1),j(null),v("")},onConfirm:O,title:"Delete User",message:`Are you sure you want to delete "${$}"? This action cannot be undone and will permanently remove the user from the system.`,confirmText:"Delete User",cancelText:"Cancel",variant:"danger"})]})}function de({roles:a,onClose:d,onSubmit:i}){const{user:f}=q(),[n,l]=c.useState({email:"",password:ee(),full_name:"",role_ids:[],menu_access:[],sub_menu_access:{},component_access:[]}),u=r=>{if(r.preventDefault(),!n.role_ids[0]){alert("Please select a role");return}i(n)},x=r=>{l(t=>({...t,role_ids:r?[r]:[]}))};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New User"}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"email",required:!0,value:n.email,onChange:r=>l(t=>({...t,email:r.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,value:n.full_name,onChange:r=>l(t=>({...t,full_name:r.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Temporary Password"}),e.jsx("input",{type:"text",value:n.password,onChange:r=>l(t=>({...t,password:r.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"User will be required to change this password on first login"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Role"}),e.jsxs("select",{required:!0,value:n.role_ids[0]||"",onChange:r=>x(r.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",children:[e.jsx("option",{value:"",children:"Select a role"}),a.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!g(f,"users","create"),className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Create User"})]})]})]})})})}function ce({user:a,roles:d,onClose:i,onSubmit:f}){const{user:n}=q(),[l,u]=c.useState({full_name:a.full_name,role_ids:a.role_ids||[],menu_access:a.menu_access||[],sub_menu_access:a.sub_menu_access||{},component_access:a.component_access||[],is_active:a.is_active,needs_password_reset:a.needs_password_reset||!1}),x=t=>{if(t.preventDefault(),!l.role_ids[0]){alert("Please select a role");return}f(l)},r=t=>{u(o=>({...o,role_ids:t?[t]:[]}))};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit User"}),e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"email",value:a.email,disabled:!0,className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 bg-gray-100 text-gray-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Full Name"}),e.jsx("input",{type:"text",required:!0,value:l.full_name,onChange:t=>u(o=>({...o,full_name:t.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Role"}),e.jsxs("select",{required:!0,value:l.role_ids[0]||"",onChange:t=>r(t.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",children:[e.jsx("option",{value:"",children:"Select a role"}),d.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:l.is_active,onChange:t=>u(o=>({...o,is_active:t.target.checked})),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsx("label",{htmlFor:"is_active",className:"ml-2 text-sm text-gray-700",children:"Active"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"needs_password_reset",checked:l.needs_password_reset,onChange:t=>u(o=>({...o,needs_password_reset:t.target.checked})),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsx("label",{htmlFor:"needs_password_reset",className:"ml-2 text-sm text-gray-700",children:"Require password reset"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!g(n,"users","update"),className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Update User"})]})]})]})})})}export{fe as AdminUsers};
