import{d as L,r as d,R as I,q as y,j as e}from"./index-HMK95Xn8.js";import{u as S,a as F,P as D,S as $}from"./search-B08KzMDg.js";import{S as K}from"./square-pen-DPDj9Mpb.js";const h="/api";class m extends Error{constructor(c){super(c),this.name="ApiError"}}async function Q(){const l=await fetch(`${h}/members`);if(!l.ok)throw new m("Failed to fetch members");return l.json()}async function R(l){const c=await fetch(`${h}/members`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!c.ok)throw new m("Failed to create member");return c.json()}async function B(l,c){const i=await fetch(`${h}/members/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!i.ok)throw new m("Failed to update member");return i.json()}async function O(l){if(!(await fetch(`${h}/members/${l}`,{method:"DELETE"})).ok)throw new m("Failed to delete member")}const w={getMembers:Q,createMember:R,updateMember:B,deleteMember:O};async function U(){const l=await fetch(`${h}/account-types`);if(!l.ok)throw new m("Failed to fetch account types");return l.json()}const z={getAccountTypes:U};function W(){const l=L(),[c,i]=d.useState(""),[n,t]=d.useState(!1),[o,s]=d.useState(!1),[a,g]=d.useState(null),[x,u]=d.useState(null),[b,p]=d.useState(null);I.useEffect(()=>{if(x||b){const r=setTimeout(()=>{u(null),p(null)},5e3);return()=>clearTimeout(r)}},[x,b]);const{data:j,isLoading:E}=S({queryKey:y.members(),queryFn:w.getMembers}),{data:N}=S({queryKey:y.accountTypes(),queryFn:z.getAccountTypes}),v=F({mutationFn:w.createMember,onSuccess:()=>{p("Member created successfully"),u(null),t(!1),l.invalidateQueries({queryKey:y.members()})},onError:r=>{u(r instanceof m?r.message:"Failed to create member"),p(null)}}),C=F({mutationFn:({memberId:r,memberData:f})=>w.updateMember(r,f),onSuccess:()=>{p("Member updated successfully"),u(null),s(!1),g(null),l.invalidateQueries({queryKey:y.members()})},onError:r=>{u(r instanceof m?r.message:"Failed to update member"),p(null)}}),T=r=>{v.mutate(r)},P=r=>{a&&C.mutate({memberId:a.id,memberData:r})},q=(j==null?void 0:j.members)||[],k=(N==null?void 0:N.account_types)||[],M=q.filter(r=>{var f;return r.name.toLowerCase().includes(c.toLowerCase())||r.email.toLowerCase().includes(c.toLowerCase())||((f=r.phone)==null?void 0:f.toLowerCase().includes(c.toLowerCase()))}),A=E||v.isPending||C.isPending;return e.jsxs("div",{className:"space-y-6 pt-24",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:"Members Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage members and their account types"})]}),e.jsxs("button",{onClick:()=>t(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Add Member"]})]}),x&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("p",{className:"text-red-800",children:x})}),b&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsx("p",{className:"text-green-800",children:b})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx($,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:c,onChange:r=>i(r.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Search members..."})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:A?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600"})}):M.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No members found"})}):e.jsx("ul",{className:"divide-y divide-gray-200",children:M.map(r=>e.jsx("li",{children:e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:r.name}),e.jsx("span",{className:"text-sm text-gray-500",children:r.email}),e.jsx("span",{className:"text-sm text-gray-500",children:r.phone})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:()=>{g(r),s(!0)},className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-blue-600 hover:bg-blue-700",title:"Edit member",children:e.jsx(K,{className:"h-4 w-4"})})})]})},r.id))})}),n&&e.jsx(J,{onClose:()=>t(!1),onSubmit:T,accountTypes:k}),o&&a&&e.jsx(_,{member:a,onClose:()=>{s(!1),g(null)},onSubmit:P,accountTypes:k})]})}function J({onClose:l,onSubmit:c,accountTypes:i}){const[n,t]=d.useState({name:"",address:"",dob:"",gender:"",email:"",phone:"",idCardNumber:"",age:"",occupation:"",maritalStatus:"",accountTypeId:"",documents:{birthCertificate:!1,idCopy:!1,applicationFeePaid:!1}}),o=s=>{s.preventDefault(),c(n)};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Member"}),e.jsxs("form",{onSubmit:o,className:"space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Full Name",value:n.name,onChange:s=>t({...n,name:s.target.value}),className:"block w-full border rounded px-3 py-2",required:!0}),e.jsx("input",{type:"email",placeholder:"Email",value:n.email,onChange:s=>t({...n,email:s.target.value}),className:"block w-full border rounded px-3 py-2"}),e.jsx("input",{type:"text",placeholder:"Phone",value:n.phone,onChange:s=>t({...n,phone:s.target.value}),className:"block w-full border rounded px-3 py-2"}),e.jsxs("select",{value:n.accountTypeId,onChange:s=>t({...n,accountTypeId:s.target.value}),className:"block w-full border rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"",children:"Select Account Type"}),i.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - Fee: ",s.processingFee]},s.id))]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.documents.birthCertificate,onChange:s=>t({...n,documents:{...n.documents,birthCertificate:s.target.checked}}),className:"mr-2"}),"Birth Certificate"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.documents.idCopy,onChange:s=>t({...n,documents:{...n.documents,idCopy:s.target.checked}}),className:"mr-2"}),"ID Copy"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.documents.applicationFeePaid,onChange:s=>t({...n,documents:{...n.documents,applicationFeePaid:s.target.checked}}),className:"mr-2"}),"Application Fee Paid"]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 bg-gray-100 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-emerald-600 text-white rounded-md",children:"Create Member"})]})]})]})})}function _({member:l,onClose:c,onSubmit:i,accountTypes:n}){const[t,o]=d.useState({...l}),s=a=>{a.preventDefault(),i(t)};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit Member"}),e.jsxs("form",{onSubmit:s,className:"space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Full Name",value:t.name,onChange:a=>o({...t,name:a.target.value}),className:"block w-full border rounded px-3 py-2",required:!0}),e.jsx("input",{type:"email",placeholder:"Email",value:t.email,onChange:a=>o({...t,email:a.target.value}),className:"block w-full border rounded px-3 py-2"}),e.jsx("input",{type:"text",placeholder:"Phone",value:t.phone,onChange:a=>o({...t,phone:a.target.value}),className:"block w-full border rounded px-3 py-2"}),e.jsxs("select",{value:t.accountTypeId,onChange:a=>o({...t,accountTypeId:a.target.value}),className:"block w-full border rounded px-3 py-2",required:!0,children:[e.jsx("option",{value:"",children:"Select Account Type"}),n.map(a=>e.jsxs("option",{value:a.id,children:[a.name," - Fee: ",a.processingFee]},a.id))]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.documents.birthCertificate,onChange:a=>o({...t,documents:{...t.documents,birthCertificate:a.target.checked}}),className:"mr-2"}),"Birth Certificate"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.documents.idCopy,onChange:a=>o({...t,documents:{...t.documents,idCopy:a.target.checked}}),className:"mr-2"}),"ID Copy"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.documents.applicationFeePaid,onChange:a=>o({...t,documents:{...t.documents,applicationFeePaid:a.target.checked}}),className:"mr-2"}),"Application Fee Paid"]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 bg-gray-100 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-md",children:"Save Changes"})]})]})]})})}export{W as default};
