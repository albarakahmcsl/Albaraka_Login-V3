import{d as O,u as R,r as x,f as E,h as p,j as e,a as F,l as N,i as w,q as u,p as B}from"./index-DRBGyz_B.js";import{u as C,P as G,S as H,T as I}from"./trash-2-CmXc8hsu.js";import{S as J}from"./square-pen-CdezQdSx.js";function $(){const l=O(),{user:d,loading:b}=R(),[h,m]=x.useState(""),[o,c]=x.useState(!1),[y,g]=x.useState(!1),[a,n]=x.useState(null),[t,r]=x.useState(null),[i,f]=x.useState(null),{data:_=[],isLoading:K}=E({queryKey:u.rolesManagement(),queryFn:N.getRoles,enabled:!b&&!!d&&p(d,"roles","view")}),{data:S=[]}=E({queryKey:u.permissionsManagement(),queryFn:B.getPermissions,enabled:!b&&!!d&&p(d,"permissions","view")}),k=C({mutationFn:N.createRole,onSuccess:()=>{f("Role created successfully"),c(!1),l.invalidateQueries({queryKey:u.rolesManagement()}),l.invalidateQueries({queryKey:u.usersManagement()})},onError:s=>{r(s instanceof w?s.message:"Failed to create role")}}),M=C({mutationFn:({roleId:s,roleData:j})=>N.updateRole(s,j),onSuccess:()=>{f("Role updated successfully"),g(!1),n(null),l.invalidateQueries({queryKey:u.rolesManagement()}),l.invalidateQueries({queryKey:u.usersManagement()})},onError:s=>{r(s instanceof w?s.message:"Failed to update role")}}),q=C({mutationFn:N.deleteRole,onSuccess:()=>{f("Role deleted successfully"),l.invalidateQueries({queryKey:u.rolesManagement()}),l.invalidateQueries({queryKey:u.usersManagement()})},onError:s=>{r(s instanceof w?s.message:"Failed to delete role")}}),A=s=>{k.mutate(s)},Q=s=>{a&&M.mutate({roleId:a.id,roleData:s})},L=s=>{confirm("Are you sure you want to delete this role? This action cannot be undone.")&&q.mutate(s)},T=K||k.isPending||M.isPending||q.isPending,U=_.filter(s=>s.name.toLowerCase().includes(h.toLowerCase())||s.description&&s.description.toLowerCase().includes(h.toLowerCase())),P=p(d,"roles","create"),D=p(d,"roles","update"),z=p(d,"roles","delete");return e.jsxs("div",{className:"space-y-6 pt-24",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[e.jsx(F,{className:"h-7 w-7 text-emerald-600 mr-2"}),"Role Management"]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Create and manage system roles with granular permissions"})]}),P&&e.jsxs("button",{onClick:()=>c(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Add Role"]})]}),t&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:e.jsx("p",{className:"text-red-800",children:t})}),i&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-md p-4",children:e.jsx("p",{className:"text-green-800",children:i})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(H,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:h,onChange:s=>m(s.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Search roles..."})]}),e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:T?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600"})}):e.jsx("ul",{className:"divide-y divide-gray-200",children:U.map(s=>{var j;return e.jsx("li",{children:e.jsxs("div",{className:"px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-emerald-100 flex items-center justify-center",children:e.jsx(F,{className:"h-5 w-5 text-emerald-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.description||"No description"}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[((j=s.permissions)==null?void 0:j.length)||0," permissions assigned"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[D&&e.jsx("button",{onClick:()=>{n(s),g(!0)},className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",title:"Edit role",children:e.jsx(J,{className:"h-4 w-4"})}),z&&s.name!=="admin"&&e.jsx("button",{onClick:()=>L(s.id),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",title:"Delete role",children:e.jsx(I,{className:"h-4 w-4"})})]})]}),s.permissions&&s.permissions.length>0&&e.jsx("div",{className:"mt-3 ml-14",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:s.permissions.map(v=>e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[v.resource,".",v.action]},v.id))})})]})},s.id)})})}),o&&P&&e.jsx(V,{permissions:S,onClose:()=>c(!1),onSubmit:A}),y&&a&&D&&e.jsx(W,{role:a,permissions:S,onClose:()=>{g(!1),n(null)},onSubmit:Q})]})}function V({permissions:l,onClose:d,onSubmit:b}){const{user:h}=R(),[m,o]=x.useState({name:"",description:"",permission_ids:[]}),c=a=>{a.preventDefault(),b(m)},y=(a,n)=>{o(t=>({...t,permission_ids:n?[...new Set([...t.permission_ids,a])]:t.permission_ids.filter(r=>r!==a)}))},g=l.reduce((a,n)=>(a[n.resource]||(a[n.resource]=[]),a[n.resource].push(n),a),{});return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-[600px] shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Role"}),e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Role Name"}),e.jsx("input",{type:"text",required:!0,value:m.name,onChange:a=>o(n=>({...n,name:a.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",placeholder:"e.g., IT Officer, Finance Manager"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:m.description,onChange:a=>o(n=>({...n,description:a.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",rows:3,placeholder:"Describe the role's responsibilities"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions"}),e.jsx("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-md p-3",children:Object.entries(g).map(([a,n])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2 capitalize",children:a}),e.jsx("div",{className:"space-y-2 ml-4",children:n.map(t=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:m.permission_ids.includes(t.id),onChange:r=>y(t.id,r.target.checked),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-700",children:[t.action,t.description&&e.jsxs("span",{className:"text-gray-500",children:[" - ",t.description]})]})]},t.id))})]},a))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!p(h,"roles","create"),className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Create Role"})]})]})]})})})}function W({role:l,permissions:d,onClose:b,onSubmit:h}){var n;const{user:m}=R(),[o,c]=x.useState({name:l.name,description:l.description||"",permission_ids:((n=l.permissions)==null?void 0:n.map(t=>t.id))||[]}),y=t=>{t.preventDefault(),h(o)},g=(t,r)=>{c(i=>({...i,permission_ids:r?[...new Set([...i.permission_ids,t])]:i.permission_ids.filter(f=>f!==t)}))},a=d.reduce((t,r)=>(t[r.resource]||(t[r.resource]=[]),t[r.resource].push(r),t),{});return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-[600px] shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit Role"}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Role Name"}),e.jsx("input",{type:"text",required:!0,value:o.name,onChange:t=>c(r=>({...r,name:t.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",disabled:l.name==="admin"}),l.name==="admin"&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Admin role name cannot be changed"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:o.description,onChange:t=>c(r=>({...r,description:t.target.value})),className:"mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Permissions"}),e.jsx("div",{className:"max-h-64 overflow-y-auto border border-gray-200 rounded-md p-3",children:Object.entries(a).map(([t,r])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2 capitalize",children:t}),e.jsx("div",{className:"space-y-2 ml-4",children:r.map(i=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:o.permission_ids.includes(i.id),onChange:f=>g(i.id,f.target.checked),className:"rounded border-gray-300 text-emerald-600 focus:ring-emerald-500"}),e.jsxs("span",{className:"ml-2 text-sm text-gray-700",children:[i.action,i.description&&e.jsxs("span",{className:"text-gray-500",children:[" - ",i.description]})]})]},i.id))})]},t))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!p(m,"roles","update"),className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Update Role"})]})]})]})})})}export{$ as AdminRoles};
