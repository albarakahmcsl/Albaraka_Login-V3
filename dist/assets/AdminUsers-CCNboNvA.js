import{d as k,e as L,r as u,j as e,a as T,f as h,g as b,q as x,i as K,k as Q}from"./index-D2mFOYqT.js";import{u as C,a as j,P as I,S as $,T as z}from"./trash-2-vFj_prUU.js";import{S as B}from"./square-pen-LkOwz6lD.js";function W(){const l=k(),i=L(),[d,n]=u.useState(""),[t,o]=u.useState(!1),[m,r]=u.useState(!1),[a,c]=u.useState(null),[f,g]=u.useState(null),[w,p]=u.useState(null),{data:y,isLoading:q}=C({queryKey:x.adminUsers(),queryFn:h.getUsers,initialData:{users:i.users}}),{data:v}=C({queryKey:x.adminRoles(),queryFn:Q.getRoles,initialData:i.roles}),N=j({mutationFn:h.createUser,onSuccess:()=>{p("User created successfully"),o(!1),l.invalidateQueries({queryKey:x.adminUsers()})},onError:s=>{g(s instanceof b?s.message:"Failed to create user")}}),U=j({mutationFn:({userId:s,userData:D})=>h.updateUser(s,D),onSuccess:()=>{p("User updated successfully"),r(!1),c(null),l.invalidateQueries({queryKey:x.adminUsers()})},onError:s=>{g(s instanceof b?s.message:"Failed to update user")}}),S=j({mutationFn:h.deleteUser,onSuccess:()=>{p("User deleted successfully"),l.invalidateQueries({queryKey:x.adminUsers()})},onError:s=>{g(s instanceof b?s.message:"Failed to delete user")}}),F=s=>N.mutate(s),E=s=>{a&&U.mutate({userId:a.id,userData:s})},M=s=>{confirm("Are you sure you want to delete this user?")&&S.mutate(s)},P=(y==null?void 0:y.users)||[],R=q||N.isPending||U.isPending||S.isPending,A=P.filter(s=>s.email.toLowerCase().includes(d.toLowerCase())||s.full_name.toLowerCase().includes(d.toLowerCase()));return e.jsxs("div",{className:"space-y-6 pt-24",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage user accounts, roles, and permissions"})]}),e.jsxs("button",{onClick:()=>o(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),f&&e.jsx(_,{type:"error",message:f}),w&&e.jsx(_,{type:"success",message:w}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx($,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:d,onChange:s=>n(s.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Search users..."})]}),e.jsx(G,{users:A,loading:R,onEdit:s=>{c(s),r(!0)},onDelete:M}),t&&e.jsx(H,{roles:v||[],onClose:()=>o(!1),onSubmit:F}),m&&a&&e.jsx(EditUserModal,{user:a,roles:v||[],onClose:()=>{r(!1),c(null)},onSubmit:E})]})}function _({type:l,message:i}){return e.jsx("div",{className:`${l==="error"?"bg-red-50 border-red-200 text-red-800":"bg-green-50 border-green-200 text-green-800"} border rounded-md p-4`,children:e.jsx("p",{children:i})})}function G({users:l,loading:i,onEdit:d,onDelete:n}){return i?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600"})}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:l.map(t=>{var o;return e.jsx("li",{children:e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-emerald-100 flex items-center justify-center",children:e.jsx(T,{className:"h-5 w-5 text-emerald-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.full_name||"No name"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.is_active?"Active":"Inactive"}),t.needs_password_reset&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Password Reset Required"})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:t.email}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Roles: ",((o=t.roles)==null?void 0:o.map(m=>m.name).join(", "))||"No roles"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>d(t),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>n(t.id),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:e.jsx(z,{className:"h-4 w-4"})})]})]})},t.id)})})})}function H({roles:l,onClose:i,onSubmit:d}){const[n,t]=u.useState({email:"",password:K(),full_name:"",role_ids:[],menu_access:[],sub_menu_access:{},component_access:[]}),o=r=>{if(r.preventDefault(),n.role_ids.length===0)return alert("Please select at least one role");d(n)},m=(r,a)=>{t(c=>({...c,role_ids:a?[...new Set([...c.role_ids,r])]:c.role_ids.filter(f=>f!==r)}))};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New User"}),e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsx(InputField,{label:"Email",value:n.email,onChange:r=>t(a=>({...a,email:r})),required:!0}),e.jsx(InputField,{label:"Full Name",value:n.full_name,onChange:r=>t(a=>({...a,full_name:r})),required:!0}),e.jsx(InputField,{label:"Temporary Password",value:n.password,onChange:r=>t(a=>({...a,password:r})),helper:"User will be required to change this password on first login"}),e.jsx(RoleSelector,{roles:l,selectedRoles:n.role_ids,onChange:m}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Create User"})]})]})]})})}export{W as AdminUsers};
