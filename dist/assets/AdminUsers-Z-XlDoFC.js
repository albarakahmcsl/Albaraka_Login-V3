import{d as $,u as I,e as V,h as E,r as h,q as g,j as e,a as B,f as b,g as N,i as G,k as H}from"./index-DXbS-fMO.js";import{u as M,a as w,P as J,S as O}from"./search-DEeJUzGC.js";import{S as W}from"./square-pen-BZ8DK6Uq.js";import{T as X}from"./trash-2-DDo7A5kh.js";function le(){const l=$(),{user:o}=I(),m=V(),s=E(o,"users","manage"),r=E(o,"users","view")||s,[a,u]=h.useState(""),[i,d]=h.useState(!1),[n,c]=h.useState(!1),[x,f]=h.useState(null),[C,y]=h.useState(null),[U,j]=h.useState(null),{data:v,isLoading:P}=M({queryKey:g.adminUsers(),queryFn:r?b.getUsers:async()=>({users:[]}),initialData:{users:m.users}}),{data:_}=M({queryKey:g.adminRoles(),queryFn:H.getRoles,initialData:m.roles}),S=w({mutationFn:b.createUser,onSuccess:()=>{j("User created successfully"),d(!1),l.invalidateQueries({queryKey:g.adminUsers()})},onError:t=>{y(t instanceof N?t.message:"Failed to create user")}}),k=w({mutationFn:({userId:t,userData:z})=>b.updateUser(t,z),onSuccess:()=>{j("User updated successfully"),c(!1),f(null),l.invalidateQueries({queryKey:g.adminUsers()})},onError:t=>{y(t instanceof N?t.message:"Failed to update user")}}),q=w({mutationFn:b.deleteUser,onSuccess:()=>{j("User deleted successfully"),l.invalidateQueries({queryKey:g.adminUsers()})},onError:t=>{y(t instanceof N?t.message:"Failed to delete user")}}),D=t=>s&&S.mutate(t),A=t=>{!x||!s||k.mutate({userId:x.id,userData:t})},L=t=>{s&&confirm("Are you sure you want to delete this user?")&&q.mutate(t)},T=(v==null?void 0:v.users)||[],K=P||s&&(S.isPending||k.isPending||q.isPending),Q=T.filter(t=>t.email.toLowerCase().includes(a.toLowerCase())||t.full_name.toLowerCase().includes(a.toLowerCase()));return e.jsxs("div",{className:"space-y-6 pt-24",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"User Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Manage user accounts, roles, and permissions"})]}),s&&e.jsxs("button",{onClick:()=>d(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),C&&e.jsx(F,{type:"error",message:C}),U&&e.jsx(F,{type:"success",message:U}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(O,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:a,onChange:t=>u(t.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-emerald-500 focus:border-emerald-500",placeholder:"Search users..."})]}),e.jsx(Y,{users:Q,loading:K,canManage:s,onEdit:t=>{f(t),c(!0)},onDelete:L}),s&&i&&e.jsx(Z,{roles:_||[],onClose:()=>d(!1),onSubmit:D}),s&&n&&x&&e.jsx(ee,{user:x,roles:_||[],onClose:()=>{c(!1),f(null)},onSubmit:A})]})}function F({type:l,message:o}){return e.jsx("div",{className:`${l==="error"?"bg-red-50 border-red-200 text-red-800":"bg-green-50 border-green-200 text-green-800"} border rounded-md p-4`,children:e.jsx("p",{children:o})})}function Y({users:l,loading:o,canManage:m,onEdit:s,onDelete:r}){return o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600"})}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:e.jsx("ul",{className:"divide-y divide-gray-200",children:l.map(a=>{var u;return e.jsx("li",{children:e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-emerald-100 flex items-center justify-center",children:e.jsx(B,{className:"h-5 w-5 text-emerald-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.full_name||"No name"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${a.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.is_active?"Active":"Inactive"}),a.needs_password_reset&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Password Reset Required"})]})]}),e.jsx("div",{className:"text-sm text-gray-500",children:a.email}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Roles: ",((u=a.roles)==null?void 0:u.map(i=>i.name).join(", "))||"No roles"]})]})]}),m&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>s(a),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>r(a.id),className:"inline-flex items-center p-2 border border-transparent rounded-full shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",children:e.jsx(X,{className:"h-4 w-4"})})]})]})},a.id)})})})}function Z({roles:l,onClose:o,onSubmit:m}){const[s,r]=h.useState({email:"",password:G(),full_name:"",role_ids:[],menu_access:[],sub_menu_access:{},component_access:[]}),a=i=>{if(i.preventDefault(),s.role_ids.length===0)return alert("Please select at least one role");m(s)},u=(i,d)=>{r(n=>({...n,role_ids:d?[...new Set([...n.role_ids,i])]:n.role_ids.filter(c=>c!==i)}))};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New User"}),e.jsxs("form",{onSubmit:a,className:"space-y-4",children:[e.jsx(p,{label:"Email",value:s.email,onChange:i=>r(d=>({...d,email:i})),required:!0}),e.jsx(p,{label:"Full Name",value:s.full_name,onChange:i=>r(d=>({...d,full_name:i})),required:!0}),e.jsx(p,{label:"Temporary Password",value:s.password,onChange:i=>r(d=>({...d,password:i})),helper:"User will be required to change this password on first login"}),e.jsx(R,{roles:l,selectedRoles:s.role_ids,onChange:u}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:o,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Create User"})]})]})]})})}function ee({user:l,roles:o,onClose:m,onSubmit:s}){var d;const[r,a]=h.useState({email:l.email,full_name:l.full_name,is_active:l.is_active,role_ids:((d=l.roles)==null?void 0:d.map(n=>n.id))||[]}),u=n=>{if(n.preventDefault(),r.role_ids.length===0)return alert("Please select at least one role");s(r)},i=(n,c)=>{a(x=>({...x,role_ids:c?[...new Set([...x.role_ids,n])]:x.role_ids.filter(f=>f!==n)}))};return e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Edit User"}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsx(p,{label:"Email",value:r.email,onChange:n=>a(c=>({...c,email:n})),required:!0}),e.jsx(p,{label:"Full Name",value:r.full_name,onChange:n=>a(c=>({...c,full_name:n})),required:!0}),e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:r.is_active,onChange:n=>a(c=>({...c,is_active:n.target.checked}))}),e.jsx("span",{className:"text-sm text-gray-700",children:"Active"})]}),e.jsx(R,{roles:o,selectedRoles:r.role_ids,onChange:i}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm font-medium text-white bg-emerald-600 hover:bg-emerald-700 rounded-md",children:"Save Changes"})]})]})]})})}function p({label:l,value:o,onChange:m,required:s,helper:r}){return e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[l,s&&"*"]}),e.jsx("input",{type:"text",value:o,onChange:a=>m(a.target.value),className:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-emerald-500 focus:border-emerald-500 sm:text-sm"}),r&&e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:r})]})}function R({roles:l,selectedRoles:o,onChange:m}){return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Roles"}),e.jsx("div",{className:"space-y-1",children:l.map(s=>e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:o.includes(s.id),onChange:r=>m(s.id,r.target.checked)}),e.jsx("span",{className:"text-sm text-gray-700",children:s.name})]},s.id))})]})}export{le as AdminUsers};
